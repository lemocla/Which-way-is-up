{% extends "base.html" %}
{% load static %}
{% load i18n %}
{% load bag_tools %}

{% block extra_title %}- checkout {% endblock %}

{% block content %}

<div class="container pt-md-5 pt-4 pb-3">
  <div class="row pb-md-3 mb-4">
    <h1 class="h1-page mt-md-0">Checkout</h1>
  </div>

  <div class="row">
    <p class="">Please fill out the form below to complete your order</p>

    <!-- order summary-->
    <div class="col-12 col-lg-6 order-lg-last ps-lg-5 mb-5">
      <div class="border shadow rounded border-lg-secondary">
        <div class="card-body row p-4 p-xl-5">
          <h2 class="fs-3 mb-4 pb-2 text-center">Order summary</h2>
          <div class="d-flex justify-content-between">
            <span class="fw-bold">Item</span>
            <span class="fw-bold">Subtotal</span>
          </div>
          <hr class="mt-3 mb-4">
          <!-- shopping bag details -->
          {% for item in bag_items %}
          <div class="d-flex justify-content-between text-muted">
            <div class="row w-100 mb-3">
              <div class="col-3 pe-0">
                <a class="img-checkout" href="{% url 'artwork_details' item.artwork.id %}">
                  <img class="img-fluid shadow rounded"
                    src="{{ MEDIA_URL }}{% if item.artwork.image %}{{ item.artwork.image }}{% else %}default_image.png{% endif %}"
                    alt="{% if not item.artwork.image %}default for {% endif %}{{ item.artwork.name }}">
                </a>
              </div>
              <div class="col">
                <p class="my-0 ">{{ item.artwork.name|title }}</p>
                <p class="mt-1 small mb-0">{{ item.artwork.materials }}</p>
                <p class="my-0 small">Qty: {{ item.quantity }}</p>
              </div>
            </div>
            <div class="">
              <p class="my-0">£{{ item.artwork.price | calc_subtotal:item.quantity }}</p>
            </div>
          </div>
          <hr>
          {% endfor %}
          <!--totals summary-->
          <div class="d-flex justify-content-between fw-bold">
            <p class="my-0">Order Total: </p>
            <p class="mb-1">£{{ total | floatformat:2 }}</p>
          </div>
          <div class="d-flex justify-content-between fw-bold">
            <p class="my-0">Delivery:</p>
            <p class="mb-1">FREE</p>
          </div>
          <div class="d-flex justify-content-between fw-bold">
            <p class="my-0">Grand Total:</p>
            <p class="mb-1">£{{ grand_total | floatformat:2 }}</p>
          </div>
        </div>
      </div>
    </div>

    <!-- checkout form -->
    <div class="col-12 col-lg-6">
      <form action="{% url 'checkout' %}" method="POST" id="checkout-form">
        {% csrf_token %}
        <div class="mb-5">
          <h2 class='trapez-bg fs-4 ps-4 py-1 mb-4'>Contact details</h2>
          {{ form.full_name | as_crispy_field }}
          {{ form.email | as_crispy_field }}
          {{ form.phone_number | as_crispy_field }}
        </div>
        <div class="mb-5">
          <h2 class='trapez-bg fs-4 ps-4 py-1 mb-4'>Gift option</h2>
          {{ form.gift_recipient | as_crispy_field }}
         <div class="form-check mb-3">
            <label class="form-check-label" for="billing-checkbox">Review the gift message
              address</label>
            <input class="form-check-input" type="checkbox" id="billing-checkbox">
          </div>
          {{ form.gift_message | as_crispy_field }}
        </div>
        <div class="mb-5">
          <h2 class='trapez-bg fs-4 ps-4 py-1 mb-4'>Delivery details</h2>
          {{ form.delivery_street_address1 | as_crispy_field }}
          {{ form.delivery_street_address2 | as_crispy_field }}
          {{ form.delivery_town_or_city | as_crispy_field }}
          {{ form.delivery_county | as_crispy_field }}
          {{ form.delivery_postcode | as_crispy_field }}
          {{ form.delivery_country | as_crispy_field }}
        </div>
        <!-- paiement-->
        <div class="mb-5">
          <h2 class='trapez-bg fs-4 ps-4 py-1 mb-4'>Payment</h2>
          <div class="form-check mb-3">
            <label class="form-check-label" for="billing-checkbox">My billing address is the same as my delivery
              address</label>
            <input class="form-check-input" type="checkbox" id="billing-checkbox" checked>
          </div>
          <!-- paiement card placeholder-->
          <div class="mb-3">
            <label for="formGroupExampleInput" class="form-label">Card details</label>
            <input type="text" class="form-control" id="formGroupExampleInput" placeholder="Card number">
          </div>
          <!-- billing address -->
          {{ form.billing_street_address1 | as_crispy_field }}
          {{ form.billing_street_address2 | as_crispy_field }}
          {{ form.billing_town_or_city | as_crispy_field }}
          {{ form.billing_county | as_crispy_field }}
          {{ form.billing_postcode | as_crispy_field }}
          {{ form.billing_country | as_crispy_field }}
          <!-- save details or login -->
          <div class="form-check mb-3">
            {% if user.is_authenticated %}
            <label class="form-check-label" for="id-save-info">Save this delivery information to my profile</label>
            <input class="form-check-input" type="checkbox" id="id-save-info" name="save-info" checked>
            {% else %}
            <label class="form-check-label" for="id-save-info">
              <a class="text-info" href="{% url 'account_signup' %}">Create an account</a> or
              <a class="text-info" href="{% url 'account_login' %}">login</a> to save this information
            </label>
            {% endif %}
          </div>
          <p class="small red-text my-0">
            <i class="fas fa-exclamation-circle"></i>
            Your card will be charged <strong>${{ total|floatformat:2 }}</strong>
          </p>
        </div>
        <!-- buttons -->
        <div class="mt-5 mb-2">
          <a href="{% url 'bag' %}" class="btn btn-white px-5 py-2 text-uppercase">
            <i class="fas fa-chevron-left pe-3"></i>Adjust Bag
          </a>
          <button id="submit-button" class="btn btn-black px-5 py-2 text-uppercase">
            Complete Order<i class="fas fa-lock ps-3"></i>
          </button>
        </div>
      </form>
    </div>

  </div>
</div>
{% endblock %}

{% block extra_js %}
{{ block.super }}
<script type="text/javascript" src="{% static 'profiles/js/profile.js' %}"></script>
{% endblock %}